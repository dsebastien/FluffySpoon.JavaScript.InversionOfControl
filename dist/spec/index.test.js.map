{"version":3,"file":"index.test.js","sourceRoot":"","sources":["../../spec/index.test.ts"],"names":[],"mappings":"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","sourcesContent":["import test from 'ava';\r\nimport { Injectable, Inject, Container } from \"../src\";\r\n\r\n@Injectable\r\nclass B1 {\r\n\r\n}\r\n\r\n@Injectable\r\nclass B2 {\r\n    \r\n}\r\n\r\n@Injectable\r\nclass A2 {\r\n\r\n}\r\n\r\ninterface MyInterface {\r\n\r\n}\r\n\r\n@Injectable\r\nclass A1Circular {\r\n    constructor(\r\n        @Inject public a: B1,\r\n        @Inject public c: B2,\r\n        @Inject public b: A1Circular) \r\n    {\r\n    }\r\n}\r\n\r\n@Injectable\r\nclass A1 {\r\n    constructor(\r\n        @Inject public a: B1,\r\n        @Inject public c: B2,\r\n        @Inject public b: A2) \r\n    {\r\n    }\r\n}\r\n\r\n@Injectable\r\nclass ExplodingB2 {\r\n    constructor() {\r\n        throw new Error('Too bad');\r\n    }\r\n}\r\n\r\n@Injectable\r\nclass Bar {\r\n    constructor(\r\n        @Inject public a: A1, \r\n        @Inject public b: A2, \r\n        @Inject public c: A2) \r\n    {\r\n    }\r\n}\r\n\r\n@Injectable\r\nclass BarWithInterface {\r\n    constructor(\r\n        @Inject public a: A1, \r\n        @Inject public b: MyInterface) \r\n    {\r\n    }\r\n}\r\n\r\n@Injectable\r\nclass BarCircular {\r\n    constructor(\r\n        @Inject public a: A1Circular, \r\n        @Inject public b: A2, \r\n        @Inject public c: A2) \r\n    {\r\n    }\r\n}\r\n\r\nlet container: Container;\r\n\r\ntest.beforeEach(() => {\r\n\tcontainer = new Container();\r\n});\r\n\r\ntest('can resolve Bar', t => {\r\n    const bar = container.resolve(Bar);\r\n\r\n    t.not(bar, null);\r\n\r\n    t.not(bar.a, null);\r\n    t.not(bar.a.a, null);\r\n    t.not(bar.a.b, null);\r\n    t.not(bar.a.c, null);\r\n\r\n    t.not(bar.b, null);\r\n\r\n    t.not(bar.c, null);\r\n});\r\n\r\ntest('can resolve Bar with instance per request', t => {\r\n    const bar = container.resolve(Bar);\r\n    \r\n    t.not(bar.c, bar.b);\r\n    t.not(bar.c, bar.a.b);\r\n});\r\n\r\ntest('explodes when using exploding dependency for Bar', t => {\r\n    container.whenRequestingType(B2).useType(ExplodingB2);\r\n\r\n    t.throws(() => container.resolve(Bar), (ex) => \r\n        ex.message.indexOf(\r\n`An error occured while resolving:\r\n-> Bar\r\n   -> A1\r\n      -> B2\r\n\r\nError: Too bad`) === 0);\r\n});\r\n\r\ntest('explodes when using circular dependencies', t => {\r\n    t.throws(() => container.resolve(BarCircular), (ex) => \r\n        ex.message.indexOf(\r\n`An error occured while resolving:\r\n-> BarCircular\r\n   -> A1Circular\r\n      -> A1Circular\r\n\r\nError: A circular dependency was detected. This can't be resolved and is a code smell.`) === 0);\r\n});\r\n\r\ntest('can resolve Bar with interfaces', t => {\r\n    t.throws(() => container.resolve(BarWithInterface), (ex) => \r\n        ex.message.indexOf(\r\n`An error occured while resolving:\r\n-> BarWithInterface\r\n   -> Object\r\n\r\nError: A dependency of type Object could not be resolved. Make sure the dependency is of a class (not an interface) type, and that it has the @Injectable decorator set.`) === 0);\r\n});\r\n\r\ntest('can resolve types', t => {\r\n    t.is(container.resolveType(Bar), Bar);\r\n});\r\n\r\ntest('can resolve types when another type is used', t => {\r\n    container.whenRequestingType(B1).useType(B2);\r\n    t.is(container.resolveType(B1), B2);\r\n});"]}